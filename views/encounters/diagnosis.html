<script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js"
        defer="true"></script>
<!-- <script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/standard.js" defer="true"></script> -->
<script type="text/javascript" src="/assets/js/jquery.min.js"></script>

<script type="text/javascript" src="/assets/js/post_parameters.js"></script>
<script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
<script type="text/javascript" src="/assets/js/moment.js"></script>
<script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
<script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>

<link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">


<link rel="stylesheet" href="/apps/OPD/assets/css/diagnosis.page.css" type="text/css">
<script type="text/javascript" src="/apps/OPD/assets/js/diagnosis.page.js"></script>

<script>
    var tt_cancel_destination = "/views/patient_dashboard.html?patient_id=" + sessionStorage.patientID;


    var malaria_test_result_concept_id = 9227;
    var malaria_observations = [];

    function initializeVariables() {
        jQuery(".loader").show();
        jQuery('#keyboard').hide();
        jQuery("#buttons").hide();
        jQuery("#inputFrame" + tstCurrentPage).hide();

        var blood_concept_id = 8612;

        var malaria_tests_ordered_url = apiProtocol + "://" + apiURL + ":" + apiPort;
        malaria_tests_ordered_url += "/api/v1/observations?person_id=" + sessionStorage.patientID;
        malaria_tests_ordered_url += "&concept_id=" + blood_concept_id;


        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                var malaria_tests_ordered_observations = JSON.parse(this.responseText);
                if (malaria_tests_ordered_observations.length > 0) {
                    for (var i = 0; i <= malaria_tests_ordered_observations.length - 1; i++) {
                        var accession_number = malaria_tests_ordered_observations[i]["accession_number"];
                        if (accession_number) {
                            accession_numbers.push(accession_number)
                            malaria_observations.push(malaria_tests_ordered_observations[i])
                        }
                    }
                    //getMalariaTestOrdersWithoutResults(accession_numbers)
                }
            }
        };

        xhttp.open("GET", malaria_tests_ordered_url, true);
        xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
        xhttp.setRequestHeader('Content-type', "application/json");
        xhttp.send();
    }

    function changeNextButton() {
        var nextButton = document.getElementById('nextButton');
        nextButton.setAttribute('onmousedown', '');
    }

</script>



<style type="text/css">

    .loader {
        position: absolute;
        display: none;
        top: 30%;
        left: 40%;
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
        z-index: 9999999999999;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }

</style>

<body id="mateme">
<div id="container">
    <div id="content">

        <form>
            <input type="text" name="initialize"
                   tt_onLoad="initializeVariables();"
                   tt_onUnLoad="resetPage();"
                   tt_pageStyleClass="NoControls" optional="true"/>


            <input type="text" name="summary"
                   tt_onLoad="__$('keyboard').style.display = 'none';changeNextButton();buildOPDdiagnosisPage();"
                   tt_pageStyleClass="NoControls" helpText="Diagnosis" optional="true"/>

        </form>

        <div class="loader"></div>
    </div>
</div>
</body>

